<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½çç³»çµ±</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const CUSTOM_AUDIO_FILES = {
          diceRoll: './custom-dice-roll.mp3',
          celebration: './custom-celebration.mp3',
        };

        const LotterySystem = () => {
          const [minNumber, setMinNumber] = useState(1);
          const [maxNumber, setMaxNumber] = useState(1000);
          const [drawCount, setDrawCount] = useState(6);
          const [minNumberInput, setMinNumberInput] = useState('1');
          const [maxNumberInput, setMaxNumberInput] = useState('1000');
          const [drawCountInput, setDrawCountInput] = useState('6');
          const [currentNumbers, setCurrentNumbers] = useState([]);
          const [absentNumbers, setAbsentNumbers] = useState([]);
          const [allWinningNumbers, setAllWinningNumbers] = useState(new Set());
          const [isDrawing, setIsDrawing] = useState(false);
          const [drawHistory, setDrawHistory] = useState([]);
          const [currentRound, setCurrentRound] = useState(1);
          const [showSettings, setShowSettings] = useState(false);
          const [soundEnabled, setSoundEnabled] = useState(true);
          const [showCelebration, setShowCelebration] = useState(false);
          const [rerollingIndices, setRerollingIndices] = useState([]);
          const [isRerolling, setIsRerolling] = useState(false);
          const [removedNumbers, setRemovedNumbers] = useState([]);
          const celebrationTimeoutRef = useRef(null);
          const audioContextRef = useRef(null);
          const customAudioCacheRef = useRef({
            diceRoll: null,
            celebration: null,
          });
          const customAudioStatusRef = useRef({
            diceRoll: 'unknown',
            celebration: 'unknown',
          });

          useEffect(() => {
            return () => {
              if (celebrationTimeoutRef.current) {
                clearTimeout(celebrationTimeoutRef.current);
              }
            };
          }, []);

          const triggerCelebration = () => {
            if (celebrationTimeoutRef.current) {
              clearTimeout(celebrationTimeoutRef.current);
            }
            setShowCelebration(true);
            celebrationTimeoutRef.current = setTimeout(() => {
              setShowCelebration(false);
            }, 2000);
          };

          useEffect(() => {
            return () => {
              Object.values(customAudioCacheRef.current).forEach((audio) => {
                if (audio) {
                  try {
                    audio.pause();
                  } catch (error) {
                    console.warn('æ¸…ç†è‡ªè¨‚éŸ³æ•ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š', error);
                  }
                }
              });
              if (audioContextRef.current) {
                audioContextRef.current.close().catch(() => {});
                audioContextRef.current = null;
              }
            };
          }, []);

          const getAudioContext = () => {
            if (!audioContextRef.current) {
              audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContextRef.current.state === 'suspended') {
              audioContextRef.current.resume().catch(() => {});
            }
            return audioContextRef.current;
          };

          const playCustomAudio = (type, fallback) => {
            const path = CUSTOM_AUDIO_FILES[type];
            if (!path) return false;

            if (customAudioStatusRef.current[type] === 'unavailable') {
              return false;
            }

            let audio = customAudioCacheRef.current[type];
            if (!audio) {
              audio = new Audio(path);
              customAudioCacheRef.current[type] = audio;
            }

            try {
              audio.currentTime = 0;
              const playPromise = audio.play();
              customAudioStatusRef.current[type] = 'available';

              if (playPromise && typeof playPromise.catch === 'function') {
                playPromise.catch((error) => {
                  console.warn(`æ’­æ”¾è‡ªè¨‚éŸ³æ•ˆå¤±æ•— (${path})ï¼Œæ”¹ç”¨é è¨­éŸ³æ•ˆã€‚`, error);
                  customAudioStatusRef.current[type] = 'unavailable';
                  customAudioCacheRef.current[type] = null;
                  if (typeof fallback === 'function') {
                    fallback();
                  }
                });
              }

              return true;
            } catch (error) {
              console.warn(`æ’­æ”¾è‡ªè¨‚éŸ³æ•ˆå¤±æ•— (${path})ï¼Œæ”¹ç”¨é è¨­éŸ³æ•ˆã€‚`, error);
              customAudioStatusRef.current[type] = 'unavailable';
              customAudioCacheRef.current[type] = null;
              return false;
            }
          };

          // éŸ³æ•ˆåŠŸèƒ½
          const playSound = (type) => {
            if (!soundEnabled) return;

            const playGeneratedSound = () => {
              const audioContext = getAudioContext();

              const createBeep = (frequency, duration, waveType = 'sine') => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = waveType;

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
              };

              const createDrumRoll = () => {
                const duration = 2;
                const bufferSize = audioContext.sampleRate * duration;
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const output = buffer.getChannelData(0);

                for (let i = 0; i < bufferSize; i++) {
                  const progress = i / bufferSize;
                  const tremolo = Math.sin(progress * Math.PI * 16);
                  const crescendo = Math.pow(progress, 2);
                  output[i] = (Math.random() * 2 - 1) * 0.35 * (0.4 + 0.6 * tremolo) * (0.2 + 0.8 * crescendo);
                }

                const noise = audioContext.createBufferSource();
                const filter = audioContext.createBiquadFilter();
                const gainNode = audioContext.createGain();

                noise.buffer = buffer;
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(900, audioContext.currentTime);
                filter.Q.setValueAtTime(0.7, audioContext.currentTime);

                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);

                const now = audioContext.currentTime;
                gainNode.gain.setValueAtTime(0.0001, now);
                gainNode.gain.exponentialRampToValueAtTime(0.5, now + 1.8);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);

                noise.start(now);
                noise.stop(now + duration);

                const accentOsc = audioContext.createOscillator();
                const accentGain = audioContext.createGain();

                accentOsc.connect(accentGain);
                accentGain.connect(audioContext.destination);

                const accentStart = now + 1.8;
                accentOsc.type = 'sine';
                accentOsc.frequency.setValueAtTime(160, accentStart);
                accentOsc.frequency.exponentialRampToValueAtTime(90, accentStart + 0.25);

                accentGain.gain.setValueAtTime(0.001, accentStart);
                accentGain.gain.exponentialRampToValueAtTime(0.5, accentStart + 0.05);
                accentGain.gain.exponentialRampToValueAtTime(0.01, accentStart + 0.4);

                accentOsc.start(accentStart);
                accentOsc.stop(accentStart + 0.5);
              };

              const createCheer = () => {
                const duration = 1.8;
                const bufferSize = audioContext.sampleRate * duration;
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const output = buffer.getChannelData(0);

                for (let i = 0; i < bufferSize; i++) {
                  const progress = i / bufferSize;
                  const swell = Math.sin(progress * Math.PI);
                  output[i] = (Math.random() * 2 - 1) * 0.25 * swell;
                }

                const crowd = audioContext.createBufferSource();
                const bandpass = audioContext.createBiquadFilter();
                const gainNode = audioContext.createGain();

                crowd.buffer = buffer;
                bandpass.type = 'bandpass';
                bandpass.frequency.setValueAtTime(1500, audioContext.currentTime);
                bandpass.Q.setValueAtTime(1.2, audioContext.currentTime);

                crowd.connect(bandpass);
                bandpass.connect(gainNode);
                gainNode.connect(audioContext.destination);

                const now = audioContext.currentTime;
                gainNode.gain.setValueAtTime(0.0001, now);
                gainNode.gain.exponentialRampToValueAtTime(0.5, now + 0.2);
                gainNode.gain.setValueAtTime(0.5, now + 1.2);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);

                crowd.start(now);
                crowd.stop(now + duration);

                const whoopOsc = audioContext.createOscillator();
                const whoopGain = audioContext.createGain();

                whoopOsc.connect(whoopGain);
                whoopGain.connect(audioContext.destination);

                whoopOsc.type = 'triangle';
                whoopOsc.frequency.setValueAtTime(650, now);
                whoopOsc.frequency.linearRampToValueAtTime(980, now + 0.5);
                whoopOsc.frequency.linearRampToValueAtTime(720, now + 1.1);

                whoopGain.gain.setValueAtTime(0.0001, now);
                whoopGain.gain.exponentialRampToValueAtTime(0.4, now + 0.1);
                whoopGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);

                whoopOsc.start(now);
                whoopOsc.stop(now + 1.3);

                setTimeout(() => createBeep(1200, 0.15), 200);
                setTimeout(() => createBeep(1400, 0.15), 350);
                setTimeout(() => createBeep(1600, 0.15), 500);
              };

              switch(type) {
                case 'diceRoll':
                  createDrumRoll();
                  break;
                case 'celebration':
                  createCheer();
                  break;
                case 'absent':
                  createBeep(220, 0.3, 'sawtooth');
                  break;
                case 'confirm':
                  createBeep(800, 0.1);
                  setTimeout(() => createBeep(1000, 0.2), 100);
                  break;
                case 'click':
                  createBeep(800, 0.05);
                  break;
              }
            };

            if ((type === 'diceRoll' || type === 'celebration') && playCustomAudio(type, playGeneratedSound)) {
              return;
            }

            playGeneratedSound();
          };

          const generateRandomNumbers = (count, min, max, exclude = new Set()) => {
            const availableNumbers = [];
            for (let i = min; i <= max; i++) {
              if (!exclude.has(i)) {
                availableNumbers.push(i);
              }
            }
            
            if (availableNumbers.length < count) {
              alert(`å¯ç”¨è™Ÿç¢¼ä¸è¶³ï¼å‰©é¤˜å¯æŠ½è™Ÿç¢¼ï¼š${availableNumbers.length}å€‹`);
              return [];
            }
            
            const shuffled = [...availableNumbers].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count).sort((a, b) => a - b);
          };

          const performDraw = () => {
            if (minNumber >= maxNumber || drawCount <= 0) {
              alert('è«‹è¨­å®šåˆç†çš„æŠ½çç¯„åœå’Œæ•¸é‡ã€‚');
              return;
            }

            if (removedNumbers.length > 0) {
              alert('ä»æœ‰ä¸åœ¨ç¾å ´çš„è™Ÿç¢¼å°šæœªç¢ºèªï¼Œè«‹å…ˆå®Œæˆæœ¬è¼ªæŠ½çã€‚');
              return;
            }

            playSound('diceRoll'); // æ’­æ”¾é¼“è²éŸ³æ•ˆ
            setIsDrawing(true);

            setTimeout(() => {
              const excludeForDraw = new Set(allWinningNumbers);
              removedNumbers.forEach(num => excludeForDraw.add(num));
              const newNumbers = generateRandomNumbers(drawCount, minNumber, maxNumber, excludeForDraw);
              if (newNumbers.length > 0) {
                setCurrentNumbers(newNumbers);
                setRerollingIndices([]);
                setIsRerolling(false);
                setAbsentNumbers([]);
                triggerCelebration();
                playSound('celebration'); // æ’­æ”¾æ­¡å‘¼éŸ³æ•ˆ
              }
              setIsDrawing(false);
            }, 2000); // å»¶é•·åˆ°2ç§’è®“å‹•ç•«å®Œæ•´æ’­æ”¾
          };

          const markAbsent = (number, index) => {
            if (number == null) return;

            playSound('absent'); // æ’­æ”¾ç¼ºå¸­éŸ³æ•ˆ
            setAbsentNumbers(prev => (prev.includes(number) ? prev : [...prev, number]));
            setRemovedNumbers(prev => (prev.includes(number) ? prev : [...prev, number]));
            setCurrentNumbers(prev => {
              const updated = [...prev];
              const targetIndex = typeof index === 'number' ? index : updated.indexOf(number);
              if (targetIndex !== -1) {
                updated[targetIndex] = null;
              }
              return updated;
            });
          };

          const redrawAbsent = () => {
            const slotsToFill = [];
            currentNumbers.forEach((num, index) => {
              if (num == null) {
                slotsToFill.push(index);
              }
            });

            if (slotsToFill.length === 0) {
              return;
            }

            playSound('diceRoll'); // æ’­æ”¾é¼“è²éŸ³æ•ˆ

            setRerollingIndices(slotsToFill);
            setIsRerolling(true);

            setTimeout(() => {
              const excludeNumbers = new Set(allWinningNumbers);
              removedNumbers.forEach(num => excludeNumbers.add(num));
              currentNumbers.forEach(num => {
                if (num != null) {
                  excludeNumbers.add(num);
                }
              });
              absentNumbers.forEach(num => excludeNumbers.add(num));

              const newNumbers = generateRandomNumbers(slotsToFill.length, minNumber, maxNumber, excludeNumbers);
              if (newNumbers.length > 0) {
                setCurrentNumbers(prev => {
                  const updated = [...prev];
                  let replacementIndex = 0;
                  for (let i = 0; i < updated.length && replacementIndex < newNumbers.length; i++) {
                    if (updated[i] == null) {
                      updated[i] = newNumbers[replacementIndex++];
                    }
                  }
                  return updated;
                });
                setAbsentNumbers([]);
                triggerCelebration();
                playSound('celebration'); // æ’­æ”¾æ­¡å‘¼éŸ³æ•ˆ
              }
              setRerollingIndices([]);
              setIsRerolling(false);
            }, 2000);
          };

          const cancelCurrentRound = () => {
            if (isDrawing || isRerolling) {
              return;
            }

            if (currentNumbers.length === 0 && removedNumbers.length === 0) {
              return;
            }

            playSound('click');
            setCurrentNumbers([]);
            setAbsentNumbers([]);
            setRemovedNumbers([]);
            setRerollingIndices([]);
            setIsRerolling(false);
          };

          const confirmWinners = () => {
            if (currentNumbers.length === 0) {
              alert('è«‹å…ˆé€²è¡ŒæŠ½ç');
              return;
            }

            if (currentNumbers.some(num => num == null)) {
              alert('ä»æœ‰ä¸åœ¨ç¾å ´çš„è™Ÿç¢¼å°šæœªé‡æ–°æŠ½å–ï¼Œè«‹å…ˆé‡æ–°æŠ½å–ã€‚');
              return;
            }

            playSound('confirm'); // æ’­æ”¾ç¢ºèªéŸ³æ•ˆ

            const newWinners = [...currentNumbers];
            const currentAbsent = [...removedNumbers];

            // å°‡ä¸­çè™Ÿç¢¼å’Œç¼ºå¸­è™Ÿç¢¼éƒ½åŠ å…¥å·²æŠ½å–é›†åˆ
            newWinners.forEach(num => allWinningNumbers.add(num));
            currentAbsent.forEach(num => allWinningNumbers.add(num));

            // åŠ å…¥æ­·å²è¨˜éŒ„
            setDrawHistory(prev => [...prev, {
              round: currentRound,
              numbers: [...newWinners],
              absentNumbers: [...currentAbsent],
              timestamp: new Date().toLocaleString('zh-TW')
            }]);

            setAllWinningNumbers(new Set(allWinningNumbers));
            setCurrentNumbers([]);
            setAbsentNumbers([]);
            setRerollingIndices([]);
            setIsRerolling(false);
            setRemovedNumbers([]);
            setCurrentRound(prev => prev + 1);

            const absentMessage = currentAbsent.length > 0 ? `\nä¸åœ¨ç¾å ´è™Ÿç¢¼ï¼š${currentAbsent.join(', ')}ï¼ˆå·²å¾è™Ÿç¢¼æ± ä¸­ç§»é™¤ï¼‰` : '';
            alert(`ç¬¬${currentRound}è¼ªæŠ½çå®Œæˆï¼ä¸­çè™Ÿç¢¼ï¼š${newWinners.join(', ')}${absentMessage}`);
          };

          const resetAll = () => {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æŠ½çè¨˜éŒ„å—ï¼Ÿ')) {
              setCurrentNumbers([]);
              setAbsentNumbers([]);
              setAllWinningNumbers(new Set());
              setDrawHistory([]);
              setCurrentRound(1);
              setRerollingIndices([]);
              setIsRerolling(false);
              setRemovedNumbers([]);
            }
          };

          const hasPendingReroll = currentNumbers.some(num => num == null);

          const handleNumberInputChange = (value, setInput, setValue) => {
            setInput(value);

            const parsed = parseInt(value, 10);
            if (!Number.isNaN(parsed)) {
              setValue(Math.max(1, parsed));
            }
          };

          const handleNumberInputBlur = (inputValue, defaultValue, setInput, setValue) => {
            const trimmed = inputValue.trim();
            if (trimmed === '') {
              setInput(String(defaultValue));
              setValue(defaultValue);
              return;
            }

            const parsed = parseInt(trimmed, 10);
            if (Number.isNaN(parsed) || parsed < 1) {
              setInput(String(defaultValue));
              setValue(defaultValue);
            } else {
              const normalized = String(parsed);
              setInput(normalized);
              setValue(parsed);
            }
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4">
              <div className="max-w-6xl mx-auto">
                <div className="text-center mb-8">
                  <h1 className="text-4xl font-bold text-white mb-2">ğŸ† æŠ½çç³»çµ± ğŸ†</h1>
                  <p className="text-blue-200">ç¬¬ {currentRound} è¼ªæŠ½ç</p>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                  {/* å·¦å´è¨­å®š */}
                  <div className="lg:col-span-1 space-y-6">
                    <div className="bg-white/10 backdrop-blur-md rounded-xl border border-white/20 p-4">
                      <button
                        onClick={() => {
                          playSound('click');
                          setShowSettings(!showSettings);
                        }}
                        className="w-full text-white font-semibold mb-4 flex items-center justify-between"
                      >
                        âš™ï¸ æŠ½çè¨­å®š
                        <span className={`transform transition-transform ${showSettings ? 'rotate-180' : ''}`}>â–¼</span>
                      </button>
                      
                      {showSettings && (
                        <div className="space-y-4">
                          <div>
                            <label className="block text-white/80 text-sm mb-2">æœ€å°è™Ÿç¢¼</label>
                            <input
                              type="number"
                              value={minNumberInput}
                              onChange={(e) => handleNumberInputChange(e.target.value, setMinNumberInput, setMinNumber)}
                              onBlur={() => handleNumberInputBlur(minNumberInput, 1, setMinNumberInput, setMinNumber)}
                              className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white"
                              min="1"
                            />
                          </div>
                          <div>
                            <label className="block text-white/80 text-sm mb-2">æœ€å¤§è™Ÿç¢¼</label>
                            <input
                              type="number"
                              value={maxNumberInput}
                              onChange={(e) => handleNumberInputChange(e.target.value, setMaxNumberInput, setMaxNumber)}
                              onBlur={() => handleNumberInputBlur(maxNumberInput, 1, setMaxNumberInput, setMaxNumber)}
                              className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white"
                              min="1"
                            />
                          </div>
                          <div>
                            <label className="block text-white/80 text-sm mb-2">æŠ½çæ•¸é‡</label>
                            <input
                              type="number"
                              value={drawCountInput}
                              onChange={(e) => handleNumberInputChange(e.target.value, setDrawCountInput, setDrawCount)}
                              onBlur={() => handleNumberInputBlur(drawCountInput, 1, setDrawCountInput, setDrawCount)}
                              className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white"
                              min="1"
                            />
                          </div>
                        </div>
                      )}
                    </div>

                    {/* éŸ³æ•ˆæ§åˆ¶ */}
                    <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                      <div className="flex items-center justify-between">
                        <span className="text-white font-semibold">ğŸ”Š éŸ³æ•ˆ</span>
                        <button
                          onClick={() => {
                            setSoundEnabled(!soundEnabled);
                            if (!soundEnabled) playSound('click');
                          }}
                          className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                            soundEnabled ? 'bg-blue-600' : 'bg-gray-600'
                          }`}
                        >
                          <span
                            className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                              soundEnabled ? 'translate-x-6' : 'translate-x-1'
                            }`}
                          />
                        </button>
                      </div>
                      <div className="text-white/70 text-xs mt-2">
                        {soundEnabled ? 'éŸ³æ•ˆå·²é–‹å•Ÿ' : 'éŸ³æ•ˆå·²é—œé–‰'}
                      </div>
                    </div>

                    {/* çµ±è¨ˆ */}
                    <div className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                      <div className="space-y-4 text-center">
                        <div>
                          <div className="text-white/80 text-sm">ç´¯è¨ˆä¸­çè™Ÿç¢¼</div>
                          <div className="text-3xl font-bold text-white">{allWinningNumbers.size}</div>
                        </div>
                        <div>
                          <div className="text-white/80 text-sm">å‰©é¤˜å¯æŠ½è™Ÿç¢¼</div>
                          <div className="text-3xl font-bold text-white">{maxNumber - minNumber + 1 - new Set([...allWinningNumbers, ...removedNumbers]).size}</div>
                        </div>
                        <div>
                          <div className="text-white/80 text-sm">å·²å®Œæˆè¼ªæ¬¡</div>
                          <div className="text-3xl font-bold text-white">{drawHistory.length}</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* å³å´æŠ½çå€ */}
                  <div className="lg:col-span-3">
                    <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 min-h-96">
                      <h2 className="text-2xl font-bold text-white mb-6">æœ¬è¼ªæŠ½ççµæœ</h2>
                      
                      <div className="text-center mb-8">
                        <button
                          onClick={() => {
                            if (hasPendingReroll) {
                              redrawAbsent();
                            } else {
                              playSound('click');
                              performDraw();
                            }
                          }}
                          disabled={isDrawing || isRerolling}
                          className="bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 text-white font-bold py-4 px-8 rounded-xl text-lg shadow-lg transform hover:scale-105 transition-all duration-200"
                        >
                          {hasPendingReroll ? (
                            isRerolling ? (
                              <div className="flex items-center gap-3">
                                <div className="animate-bounce">ğŸ²</div>
                                <span>é‡æ–°æŠ½å–ä¸­...</span>
                                <div className="animate-bounce" style={{animationDelay: '0.1s'}}>ğŸ²</div>
                              </div>
                            ) : (
                              'ğŸ”„ é‡æ–°æŠ½å–'
                            )
                          ) : isDrawing ? (
                            <div className="flex items-center gap-3">
                              <div className="animate-bounce">ğŸ²</div>
                              <span>æŠ½çä¸­...</span>
                              <div className="animate-bounce" style={{animationDelay: '0.1s'}}>ğŸ²</div>
                            </div>
                          ) : (
                            'ğŸ² é–‹å§‹æŠ½ç'
                          )}
                        </button>
                      </div>

                      {/* æŠ½çé€²è¡Œä¸­çš„å‹•ç•« */}
                      {isDrawing && (
                        <div className="text-center mb-8">
                          <div className="flex justify-center items-center gap-4 mb-4">
                            <div className="text-6xl animate-spin">ğŸ²</div>
                            <div className="text-6xl animate-spin" style={{animationDelay: '0.2s'}}>ğŸ²</div>
                            <div className="text-6xl animate-spin" style={{animationDelay: '0.4s'}}>ğŸ²</div>
                          </div>
                          <div className="text-white text-xl animate-pulse">
                            æ­£åœ¨æŠ½å– {drawCount} å€‹å¹¸é‹è™Ÿç¢¼...
                          </div>
                          <div className="mt-4">
                            <div className="bg-white/20 rounded-full h-2 overflow-hidden">
                              <div className="bg-yellow-400 h-full animate-pulse" style={{width: '100%'}}></div>
                            </div>
                          </div>
                        </div>
                      )}

                      {currentNumbers.length > 0 && !isDrawing && (
                        <div className="mb-6">
                          <div className="text-center mb-4">
                            <div className={`text-3xl ${showCelebration ? 'animate-bounce' : ''}`}>ğŸ‰</div>
                            <div className={`text-white text-xl font-bold ${showCelebration ? 'animate-pulse' : ''}`}>
                              æ­å–œä¸­çï¼
                            </div>
                          </div>
                          <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                            {currentNumbers.map((number, index) => {
                              const isSlotRerolling = rerollingIndices.includes(index);
                              return (
                              <div
                                key={index}
                                className={`relative ${showCelebration ? 'animate-bounce' : ''}`}
                                style={{animationDelay: `${index * 0.1}s`, animationDuration: '1s'}}
                              >
                                <div className={`bg-gradient-to-r ${number != null ? 'from-yellow-400 to-orange-500' : 'from-gray-500 to-gray-600'} rounded-lg p-6 text-center shadow-lg transform ${number != null ? 'hover:scale-105' : ''} transition-all ${showCelebration ? 'animate-pulse' : ''}`}>
                                  {number != null ? (
                                    <div className="text-3xl font-bold text-white">{number}</div>
                                  ) : isSlotRerolling ? (
                                    <div className="flex flex-col items-center gap-2 text-white">
                                      <div className="text-4xl animate-spin">ğŸ²</div>
                                      <div className="text-sm tracking-widest">é‡æ–°æŠ½å–ä¸­</div>
                                    </div>
                                  ) : (
                                    <div className="text-3xl font-bold text-white">å¾…æŠ½å–</div>
                                  )}
                                </div>
                                {number != null && (
                                  <button
                                    onClick={() => markAbsent(number, index)}
                                    className="absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 text-sm font-bold shadow-lg"
                                    title="æ¨™è¨˜ç‚ºä¸åœ¨ç¾å ´"
                                  >
                                    Ã—
                                  </button>
                                )}
                              </div>
                            );
                            })}
                          </div>

                          <div className="text-center space-y-3">
                            <div className="flex flex-col sm:flex-row justify-center items-center gap-3">
                              <button
                                onClick={confirmWinners}
                                disabled={currentNumbers.some(num => num == null) || isDrawing || isRerolling}
                                className="bg-green-600 hover:bg-green-700 disabled:opacity-50 text-white font-bold py-3 px-8 rounded-lg animate-pulse"
                              >
                                ğŸ† ç¢ºèªä¸­ç
                              </button>
                              <button
                                onClick={cancelCurrentRound}
                                disabled={isDrawing || isRerolling || (currentNumbers.length === 0 && removedNumbers.length === 0)}
                                className="bg-gray-500 hover:bg-gray-600 disabled:opacity-50 text-white font-semibold py-3 px-6 rounded-lg"
                              >
                                â¹ï¸ å–æ¶ˆæœ¬è¼ª
                              </button>
                            </div>
                            {currentNumbers.some(num => num == null) && (
                              <p className="text-sm text-white/70">è«‹å…ˆé‡æ–°æŠ½å–ç¼ºå¸­çš„è™Ÿç¢¼ä»¥å¡«æ»¿ç©ºç¼ºã€‚</p>
                            )}
                          </div>
                        </div>
                      )}

                      {currentNumbers.length === 0 && !isDrawing && (
                        <div className="text-center text-white/60 py-16">
                          <div className="text-6xl mb-4">ğŸ†</div>
                          <p className="text-xl">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŠ½ç</p>
                        </div>
                      )}
                    </div>
                  </div>
                </div>

                {/* ç¼ºå¸­è™Ÿç¢¼å€åŸŸ */}
                {(removedNumbers.length > 0 || hasPendingReroll) && (
                  <div className="bg-red-500/20 backdrop-blur-md rounded-xl p-6 mb-6 border border-red-500/30">
                    <h2 className="text-xl font-semibold text-white mb-4">ä¸åœ¨ç¾å ´è™Ÿç¢¼</h2>
                    <div className="grid grid-cols-2 md:grid-cols-6 gap-4 mb-4">
                      {removedNumbers.map((number, index) => (
                        <div key={index} className="bg-red-500 rounded-lg p-4 text-center shadow-lg">
                          <div className="text-2xl font-bold text-white">{number}</div>
                        </div>
                      ))}
                    </div>
                    {hasPendingReroll && (
                      <p className="text-center text-white/80">è«‹ä½¿ç”¨ä¸Šæ–¹æŒ‰éˆ•é‡æ–°æŠ½å–ç¼ºå¸­çš„è™Ÿç¢¼ã€‚</p>
                    )}
                  </div>
                )}

                {/* ä¸­çè¨˜éŒ„ */}
                {drawHistory.length > 0 && (
                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 mb-6 border border-white/20">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-xl font-semibold text-white flex items-center gap-2">
                        ğŸ‘¥ ä¸­çè¨˜éŒ„
                      </h2>
                      <button
                        onClick={resetAll}
                        className="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg text-sm"
                      >
                        é‡ç½®å…¨éƒ¨
                      </button>
                    </div>
                    <div className="space-y-3 max-h-60 overflow-y-auto">
                      {drawHistory.map((record, index) => (
                        <div key={index} className="bg-white/10 rounded-lg p-3">
                          <div className="flex justify-between items-start mb-2">
                            <span className="font-semibold text-white">ç¬¬ {record.round} è¼ª</span>
                            <span className="text-white/70 text-sm">{record.timestamp}</span>
                          </div>
                          <div className="mb-2">
                            <div className="text-white/80 text-sm mb-1">ä¸­çè™Ÿç¢¼ï¼š</div>
                            <div className="flex flex-wrap gap-2">
                              {record.numbers.map((num, numIndex) => (
                                <span key={numIndex} className="bg-yellow-500 text-white px-2 py-1 rounded text-sm font-semibold">
                                  {num}
                                </span>
                              ))}
                            </div>
                          </div>
                          {record.absentNumbers && record.absentNumbers.length > 0 && (
                            <div>
                              <div className="text-white/80 text-sm mb-1">ä¸åœ¨ç¾å ´ï¼š</div>
                              <div className="flex flex-wrap gap-2">
                                {record.absentNumbers.map((num, numIndex) => (
                                  <span key={numIndex} className="bg-red-500 text-white px-2 py-1 rounded text-sm font-semibold">
                                    {num}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<LotterySystem />, document.getElementById('root'));
    </script>
</body>
</html>